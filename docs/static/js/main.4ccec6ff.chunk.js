(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{18:function(e,t,i){e.exports=i(54)},26:function(e,t,i){},42:function(e,t,i){},44:function(e,t,i){},46:function(e,t,i){},48:function(e,t,i){},50:function(e,t,i){},52:function(e,t,i){},54:function(e,t,i){"use strict";i.r(t);i(19);var n=i(0),a=i.n(n),o=i(7),s=i.n(o),r=(i(26),i(16)),c=i(8),u=i(15),l=i(1),h=i(2),d=i(4),f=i(3),p=i(5),m=i(10),g=(i(42),i(44),function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"Results"},this.props.searchResults.map(function(t,i){return a.a.createElement("img",{className:"search-result-gif",key:i,src:t.images.fixed_height_small.url,onClick:function(){return e.props.onGifClick(t)}})}))}}]),t}(n.Component)),v=(i(46),function(e,t){fetch("http://api.giphy.com"+"/v1/gifs/search"+"?api_key="+"PrDuQjBTO5H7jg1eO1xj6sx5zGCsi4Y6"+"&q="+e,{cors:"cors",cache:"no-cache"}).then(function(e){return e.json()}).then(function(e){return t(e.data)})}),w=function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(d.a)(this,Object(f.a)(t).call(this,e))).handleSearch=function(){v(i.state.query,function(e){i.setState({results:e,loading:!1})})},i.handleChange=function(e){i.setState({query:e.target.value}),null===i.searchTimeoutId&&clearTimeout(i.searchTimeoutId),""!==e.target.value?(i.searchTimeoutId=setTimeout(i.handleSearch,1500),i.setState({loading:!0})):i.setState({loading:!1})},i.state={query:"",loading:!1,results:[]},i.queryInput=a.a.createRef(),i.searchTimeoutId=null,i}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentDidUpdate",value:function(e,t){e.open!==this.props.open&&this.props.open&&this.queryInput.current.focus()}},{key:"componentWillUnmount",value:function(){clearInterval(this.intervalId)}},{key:"render",value:function(){return this.props.open?a.a.createElement("div",{className:"giphy-search"},a.a.createElement("div",{className:"search-box"},a.a.createElement("input",{type:"text",placeholder:"enter a search term",value:this.state.query,onChange:this.handleChange,ref:this.queryInput,className:"query-input"})),a.a.createElement(g,{searchResults:this.state.query?this.state.results:this.props.previouslyUsedGifs,onGifClick:this.props.onGifClick}),a.a.createElement("h5",{className:"search-title"},"Choose a gif",this.state.loading?a.a.createElement("span",{className:"loading"},"  loading"):"")):""}}]),t}(n.Component),y=i(13),b=i.n(y),G=function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(d.a)(this,Object(f.a)(t).call(this,e))).onEnd=function(){"once"===i.props.duration&&i.props.onEnd()},i.state={isReady:!1},i.element=a.a.createRef(),i.timeoutId=null,i}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.wrapper=new b.a({gif:this.element.current,auto_play:this.props.playing,progressbar_height:0,loop_mode:this.props.loop,on_end:this.onEnd,max_width:this.props.width}),this.wrapper.load(function(){return e.setState({isReady:!0})})}},{key:"componentDidUpdate",value:function(e,t){var i=this;e.playing!==this.props.playing&&this.state.isReady?this.props.playing?(this.wrapper.move_to(0),this.wrapper.play(),"5sec"!==this.props.duration||this.timeoutId||(this.timeoutId=setTimeout(function(){i.props.onEnd(),i.timeoutId=null},5e3))):(this.wrapper.pause(),clearTimeout(this.timeoutId)):this.props.playing&&!this.timeoutId&&"5sec"===this.props.duration&&(this.timeoutId=setTimeout(function(){i.props.onEnd(),i.timeoutId=null},5e3))}},{key:"render",value:function(){if(!this.props.src)return"";var e=this.props.src.slice(0,-"giphy.gif".length)+"200w.gif";return a.a.createElement("div",{style:this.props.style,className:this.props.className},a.a.createElement("img",{ref:this.element,src:e,alt:this.props.alt,width:this.props.width,height:this.props.height}))}}]),t}(n.Component);G.defaultProps={autoPlay:!1,src:null,style:{},loop:!1,width:null,height:null,duration:"once"};var I=G,S=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return this.props.gif?a.a.createElement(I,{className:"gif-player",src:this.props.gif.url,alt:"gif",style:{left:this.props.gif.positionX,width:this.props.width,top:this.props.gif.positionY,visibility:this.props.playing?"visible":"hidden"},playing:this.props.playing,duration:this.props.gif.duration,width:this.props.width,loop:"once"!==this.props.gif.duration,onEnd:this.props.onEnd}):""}}]),t}(a.a.Component),E=(i(48),function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"gif-bar"},this.props.showMarkers?this.props.gifs.map(function(e){return a.a.createElement("div",{className:"gif-marker",key:e.url+e.timeFraction,style:{marginLeft:100*e.timeFraction+"%"}})}):"")}}]),t}(a.a.Component)),j=(i(50),"http://gif-backend.herokuapp.com"),O="http://noembed.com/embed?url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D",k=(i(52),function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"video-info",style:{backgroundImage:"url("+this.props.videoInfo.thumbnail_url+")"},onClick:function(){window.location="?id="+e.props.videoId}},a.a.createElement("span",null,this.props.videoInfo.title))}}]),t}(n.Component)),C=function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(d.a)(this,Object(f.a)(t).call(this,e))).state={videoInfo:null,loading:!0},i}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch(O+this.props.videoId).then(function(e){return e.json()}).then(function(t){return e.setState({videoInfo:t,loading:!1})})}},{key:"render",value:function(){return!this.state.loading&&this.state.videoInfo.error?"":this.state.loading?a.a.createElement("div",{className:"video-info"},"Loading"):a.a.createElement(k,{videoInfo:this.state.videoInfo,videoId:this.props.videoId})}}]),t}(n.Component),N=function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(d.a)(this,Object(f.a)(t).call(this,e))).hideList=function(e){e.preventDefault(),i.props.onHide&&i.props.onHide()},i.state={loading:!0,videoIds:[]},i}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch(j+"/videos").then(function(e){return e.json()}).then(function(t){e.setState({videoIds:Array.from(new Set(t.map(function(e){return e.videoId}).filter(function(e){return e}))),loading:!1})})}},{key:"render",value:function(){return a.a.createElement("div",{className:"videos-list",style:{visibility:!this.props.visible&&"hidden"}},a.a.createElement("button",{href:"#",onClick:this.hideList,className:"hide-link"},"Hide"),this.state.loading&&a.a.createElement("div",{className:"results-loading"},"Loading"),this.state.videoIds.map(function(e){return a.a.createElement(C,{videoId:e})}))}}]),t}(n.Component),D=i(17),R=function(e){function t(e){var i;return Object(l.a)(this,t),(i=Object(d.a)(this,Object(f.a)(t).call(this,e))).handleEsc=function(e){"Escape"===e.key&&i.setState({showGifSearch:!1})},i.handleDocumentClick=function(e){i.state.videoId&&i.showGifSearch&&!i.searchDiv.current.contains(e.target)&&i.setState({showGifSearch:!1})},i.serverGifToLocal=function(e){return{url:e.gifId,timeFraction:e.timestamp,fracX:e.fracX,fracY:e.fracY,serverId:e._id,scale:e.scale,duration:e.duration}},i.fetchGifs=function(){return fetch(j+"/gifs?videoId="+i.state.videoId).then(function(e){return e.json()}).then(function(e){return e.gifs.map(i.serverGifToLocal)})},i.getVideoDuration=function(e){return i.player.current.internalPlayer.getDuration()},i.onPlayerReady=function(){i.intervalId=setInterval(i.timer,100),Promise.all([i.fetchGifs(),i.getVideoDuration()]).then(function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1];i.setState({gifs:i.computeGifPositions(n).sort(function(e,t){return e.timeFraction-t.timeFraction}),videoDuration:a})})},i.onPlayerStateChange=function(e){1===e.data?(i.setState({videoPlaying:!0}),clearTimeout(i.gifBarTimeoutId),i.gifBarTimeoutId=setTimeout(function(){return i.setState({showGifBar:!1})},4e3)):(i.setState({showGifBar:!0,videoPlaying:!1}),clearTimeout(i.gifBarTimeoutId))},i.onMouseMove=function(e){i.state.videoPlaying&&(clearTimeout(i.gifBarTimeoutId),i.setState({showGifBar:!0}),i.gifBarTimeoutId=setTimeout(function(){return i.setState({showGifBar:!1})},2e3))},i.timer=function(){try{i.player.current.internalPlayer.getCurrentTime().then(function(e){i.setState({currentVideoTime:e}),i.setState(function(t){var i=t.gifs,n=t.videoDuration,a=!1,o=i.map(function(t){return Math.abs(e-t.timeFraction*n)<.15?(a=!0,Object.assign(t,{playing:!0})):t});if(a)return{gifs:o}})})}catch(e){clearInterval(i.intervalId)}},i.gifEnded=function(e){i.setState(function(t){var i=t.gifs,n=i.findIndex(function(t){return t.url===e.url&&t.timeFraction===e.timeFraction});return-1===n?i:{gifs:Object(c.a)(i.slice(0,n)).concat([Object.assign(e,{playing:!1})],Object(c.a)(i.slice(n+1)))}})},i.toggleGifSearch=function(){i.setState(function(e){return{showGifSearch:!e.showGifSearch}})},i.closeGifSearch=function(){i.setState({showGifSearch:!1})},i.handleCancel=function(){i.setState({newGif:null,showGifSearch:!1})},i.addNewGif=function(e){i.setState(function(t){var i=t.previouslyUsedGifs;return i.includes(e)?{newGif:e,showGifSearch:!1}:{newGif:e,showGifSearch:!1,previouslyUsedGifs:[e].concat(Object(c.a)(i))}},function(){return localStorage.setItem("usedGifs",JSON.stringify(i.state.previouslyUsedGifs))}),i.player.current.internalPlayer.pauseVideo()},i.postNewGif=function(e){fetch(j+"/gifs",{method:"post",cache:"no-cache",cors:"cors",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({videoId:e.videoId,gifId:e.url,gifTimestamp:e.timeFraction,fracX:e.fracX,fracY:e.fracY,scale:e.scale,duration:e.duration})})},i.getRealVideoDimensions=function(){var e=s.a.findDOMNode(i.player.current).children[0].getBoundingClientRect(),t=Math.min(e.width/i.state.videoInfo.width,e.height/i.state.videoInfo.height);return{width:t*i.state.videoInfo.width,height:t*i.state.videoInfo.height}},i.computeGifPositions=function(e){var t=i.getRealVideoDimensions(),n=s.a.findDOMNode(i.player.current).children[0].getBoundingClientRect();return e.map(function(e){var i=Math.min(Math.max(e.fracX*t.width+n.width/2,0),n.width-100),a=Math.min(Math.max(e.fracY*t.height+n.height/2,0),n.height-100);return Object(r.a)({},e,{positionX:i,positionY:a})})},i.updateGifPositions=function(){i.setState(function(e){var t=e.gifs;return{gifs:i.computeGifPositions(t)}})},i.onWindowResize=function(){i.updateGifPositions()},i.saveNewGif=function(){var e=i.state.newGif,t="https://media.giphy.com/media/".concat(e.id,"/giphy.gif"),n=i.state.currentVideoTime,a=i.state.videoId,o=i.getRealVideoDimensions(),r=s.a.findDOMNode(i.player.current).children[0].getBoundingClientRect(),c={url:t,time:n,videoId:a,fracX:(i.state.newGifX-r.width/2)/o.width,fracY:(i.state.newGifY-r.height/2)/o.height,scale:i.newGifRnd.current.getBoundingClientRect().width/o.width,duration:i.state.newGifDuration,positionX:i.state.newGifX,positionY:i.state.newGifY,timeFraction:n/i.state.videoDuration};i.postNewGif(c),console.log("adding gif "+c),i.setState({gifs:i.state.gifs.concat([c]),newGif:null,newGifX:0,newGifY:0,newGifSize:{width:!1,height:!1},newGifDuration:"once"})},i.state={gifs:[],videoId:i.props.urlParams.get("id"),videoInfo:null,videoDuration:null,videoPlaying:!1,newGif:null,newGifX:0,newGifY:0,newGifSize:{width:!1,height:!1},newGifDuration:"once",previouslyUsedGifs:JSON.parse(localStorage.getItem("usedGifs"))||[],showGifSearch:!1,showAddGif:!1,showGifBar:!0,showVideosList:!1},i.player=a.a.createRef(),i.searchDiv=a.a.createRef(),i.newGifRnd=a.a.createRef(),document.addEventListener("mousedown",i.handleDocumentClick,!1),document.addEventListener("keydown",i.handleEsc,!1),window.addEventListener("resize",i.onWindowResize,!1),i}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleDocumentClick,!1),document.removeEventListener("keydown",this.handleEsc,!1),window.removeEventListener("resize",this.onWindowResize,!1),clearInterval(this.intervalId)}},{key:"componentDidMount",value:function(){var e=this;this.state.videoId?(fetch(j+"/videos",{method:"post",cache:"no-cache",cors:"cors",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({videoId:this.state.videoId})}),fetch(O+this.state.videoId).then(function(e){return e.json()}).then(function(t){return e.setState({videoInfo:t})})):window.location="?id=dQw4w9WgXcQ"}},{key:"render",value:function(){var e=this;return null===this.state.videoId?a.a.createElement("div",{className:"App"},"Please enter video id in the url. Like this: ",a.a.createElement("a",{href:"?id=dQw4w9WgXcQ"},"?id=dQw4w9WgXcQ"),"."):a.a.createElement("div",{className:"App container"},a.a.createElement(N,{onHide:function(){return e.setState({showVideosList:!1})},visible:this.state.showVideosList}),a.a.createElement("div",{className:"header"},a.a.createElement("h1",null,"Gifgif"),a.a.createElement("button",{className:"show-videos-list",onClick:function(){return e.setState({showVideosList:!0})}},"Other videos"),this.state.newGif?a.a.createElement("button",{type:"button",className:"btn btn-success save-gif-button",onClick:this.saveNewGif},"Save"):"",this.state.showGifSearch||this.state.newGif?a.a.createElement("button",{type:"button",className:"btn btn-danger add-gif-button",onClick:this.handleCancel},"Cancel"):a.a.createElement("button",{type:"button",className:"btn btn-primary add-gif-button",onClick:this.toggleGifSearch},"Add gif"),this.state.newGif&&a.a.createElement("div",{className:"choose-duration"},a.a.createElement("span",{className:"play-label"},"Choose place and time for the gif. Play gif"),a.a.createElement("div",{className:"btn-group btn-group-toggle","data-toggle":"buttons"},a.a.createElement("button",{className:"btn btn-sm btn-primary "+("once"===this.state.newGifDuration?"active":""),onClick:function(){return e.setState({newGifDuration:"once"})}},"once"),a.a.createElement("button",{className:"btn btn-sm btn-primary"+("once"!==this.state.newGifDuration?" active":""),onClick:function(){return e.setState({newGifDuration:"5sec"})}},"for 5 seconds")))),a.a.createElement("div",{className:"videoFrame",onMouseMove:this.onMouseMove},a.a.createElement(m.a,{videoId:this.state.videoId,opts:{width:"100%",height:"100%",playerVars:{autoplay:1}},ref:this.player,onReady:this.onPlayerReady,onStateChange:this.onPlayerStateChange}),this.state.newGif&&a.a.createElement("div",{className:"protective-screen"}),this.state.newGif?a.a.createElement(D.a,{bounds:"parent",lockAspectRatio:!0,onDragStop:function(t,i){return e.setState({newGifX:i.x,newGifY:i.y})},onResize:function(t,i,n){return e.setState({newGifSize:n.getBoundingClientRect()})}},a.a.createElement("img",{src:this.state.newGif.images.fixed_height_small.url,style:{width:this.state.newGifSize.width||"100%",height:this.state.newGifSize.height||"100%"},ref:this.newGifRnd})):"",a.a.createElement(E,{gifs:this.state.gifs,showMarkers:this.state.showGifBar}),a.a.createElement("div",{ref:this.searchDiv},a.a.createElement(w,{onGifClick:this.addNewGif,previouslyUsedGifs:this.state.previouslyUsedGifs,open:this.state.showGifSearch,closeGifSearch:this.closeGifSearch})),this.state.gifs.map(function(t){return a.a.createElement(S,{gif:t,key:t.url+t.timeFraction,width:t.scale*e.getRealVideoDimensions().width||200,playing:t.playing,onEnd:function(){return e.gifEnded(t)}})})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var T=new URLSearchParams(window.location.search);s.a.render(a.a.createElement(R,{urlParams:T}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[18,2,1]]]);
//# sourceMappingURL=main.4ccec6ff.chunk.js.map